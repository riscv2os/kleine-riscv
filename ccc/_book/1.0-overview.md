### 第一章：RISC-V 概述

#### 1.1 RISC-V 的歷史與發展

RISC-V 是一個由加州大學伯克利分校於 2010 年推出的開源指令集架構（ISA）。其核心理念是簡單、模塊化、靈活以及開源，以滿足不同的處理器需求。RISC-V 的設計目標之一是提供一個精簡且功能強大的指令集，使其能夠在嵌入式系統到高性能計算的廣泛應用場景中運行。

RISC-V 的發展可以追溯到 RISC（精簡指令集計算）運動，它是針對複雜指令集架構（CISC）的回應，旨在簡化處理器設計，提升效率。與傳統商業指令集架構（如 x86 和 ARM）不同，RISC-V 完全開放，允許設計者和企業免費使用和修改，這大大促進了創新和應用的擴展。

自發布以來，RISC-V 已迅速發展，受到學術界、產業界和開發者社群的廣泛關注和支持。如今，RISC-V 已成為全球公認的標準，並逐步應用於許多領域，如物聯網（IoT）、自動駕駛、雲計算和人工智慧等。

#### 1.2 RISC-V 指令集架構概覽

RISC-V 的設計基於精簡指令集原則，其指令集具有高度的模塊化和可擴展性。RISC-V 以一個精簡的基礎指令集（Base ISA）為核心，並支持多種可選擴展模塊來滿足不同應用需求。這種設計允許硬體設計者根據特定應用選擇合適的模塊，達到性能與功耗之間的平衡。

- **基本指令集（RV32I 和 RV64I）**：提供基本的算術、邏輯和控制流指令，適用於 32 位和 64 位處理器。
- **乘法與除法擴展（M 扩展）**：提供高效的整數乘法和除法指令，適用於數據密集型應用。
- **浮點運算擴展（F 和 D 擴展）**：支持單精度和雙精度浮點數運算，應用於高性能計算和科學計算。
- **原子操作擴展（A 擴展）**：支持原子內存操作，適用於多處理器系統中的同步操作。
- **壓縮指令集（C 擴展）**：通過使用更短的指令來減少程序的內存佔用，適用於資源受限的嵌入式系統。

RISC-V 也為未來的擴展留下了充分的空間，使得它可以持續發展以支持新興技術，如向量運算（V 擴展）和安全擴展（S 擴展）。

#### 1.3 RISC-V 的組合語言範例集

在學習 RISC-V 處理器架構時，理解組合語言的寫法是非常重要的，因為它能讓我們了解處理器如何執行具體的指令。以下範例將展示一些常見的 RISC-V 組合語言程式，幫助讀者熟悉這個指令集。

#### 範例 1：簡單的加法
這是一個基本的加法運算範例，將兩個數相加並儲存在一個寄存器中。

```assembly
# 加法運算：x3 = x1 + x2
    add x3, x1, x2
```

在這個範例中，`add` 指令將 `x1` 和 `x2` 兩個寄存器中的值相加，結果儲存在 `x3` 中。

#### 範例 2：條件分支
這是一個簡單的條件分支範例，根據寄存器中的值進行跳轉。

```assembly
# 如果 x1 等於 x2，則跳轉到 label
    beq x1, x2, label
# 其他指令
label:
    # 跳轉後執行的指令
```

`beq` 指令是 "Branch if Equal"，當 `x1` 和 `x2` 相等時，程序將跳轉到 `label` 標籤的位置繼續執行。

#### 範例 3：迴圈
這是一個簡單的迴圈範例，將一個計數器逐步遞減，直到其值為零。

```assembly
    li x5, 10      # 將 10 加載到 x5
loop:
    beq x5, x0, end  # 如果 x5 為 0，跳轉到 end
    addi x5, x5, -1  # 將 x5 減 1
    j loop           # 跳回 loop 標籤
end:
    # 結束迴圈後的程式
```

這段程式碼展示了一個使用 `beq` 和 `addi` 指令的迴圈，迴圈每次迭代將計數器 `x5` 減 1，直到它變成零。

#### 範例 4：載入與儲存
RISC-V 提供簡單直接的載入與儲存指令，可以將記憶體中的數據載入到寄存器中，或將寄存器中的數據儲存到記憶體中。

```assembly
    lw x3, 0(x1)    # 將 x1 地址中的數據載入到 x3
    sw x3, 4(x1)    # 將 x3 的數據儲存到 x1 + 4 的地址
```

這裡，`lw`（load word）指令從內存位置載入 32 位數據到 `x3`，而 `sw`（store word）指令將 `x3` 的數據儲存到記憶體中。

#### 範例 5：子程序調用
以下範例展示了如何使用 `jal` 和 `jalr` 指令進行子程序調用和返回。

```assembly
    jal x1, function  # 跳轉到 function 標籤並將返回地址儲存到 x1
    # 其他指令
function:
    # 子程序內容
    jalr x0, x1, 0    # 返回主程序
```

`jal` 指令將跳轉到子程序，並將返回地址存入 `x1`，而 `jalr` 指令則負責從子程序返回主程序。

### 範例總結
這些簡單的範例展示了 RISC-V 的一些核心指令與基本功能。透過組合語言範例，讀者可以更好地理解指令集的運作，並深入學習處理器的低階運算模式。在接下來的章節中，我們將探討如何將這些指令應用到硬體設計中，並解釋它們在 CPU 設計中的具體實現。


#### 1.4 RISC-V 的開源生態系統

RISC-V 不僅是一個指令集架構，還代表了一個活躍且不斷增長的開源生態系統。RISC-V 基金會負責標準的推廣和維護，並且有許多公司和研究機構參與到 RISC-V 生態系統的建設中。

- **硬體設計工具**：包括開源的處理器核設計（如 Rocket 和 BOOM），這些核設計可以直接應用於芯片設計中。
- **模擬和驗證工具**：如 Spike、QEMU 和 Verilator，為 RISC-V 處理器的開發和模擬提供了強有力的支持。
- **編譯器和軟件開發工具鏈**：如 GCC 和 LLVM 編譯器的 RISC-V 支持，為開發者提供了完整的軟件開發工具鏈。
- **作業系統支持**：包括 Linux、FreeBSD 和 RTOS 等眾多操作系統的支持，使得 RISC-V 可以應用於各類設備中。

這個開源生態系統使得 RISC-V 在學術界和產業界迅速普及，並推動了處理器設計的創新和多樣化。